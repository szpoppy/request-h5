"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueUnicom=t()}(window,function(){function e(e,t){var r=this.events[e];return r||(r=this.events[e]=[]),r.push(t),this}function t(e,t){if(!e)return this.events={},this;if(!t)return delete this.events[e],this;var r=this.events[e];if(!r)return this;var n=r.indexOf(t);return n>=0&&r.splice(n,1),this}function r(e,t,r){if(e&&e.length)for(var n=0;n<e.length;n+=1)e[n].apply(t,r);return r}function n(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return C(r,function(t){C(t,function(t,r){t&&"object"==(void 0===t?"undefined":_typeof(t))?(null!=e[r]&&b.call(e[r])==b.call(t)||(e[r]=t instanceof Array?[]:{}),n(e[r],t)):e[r]=t})}),e}function o(e,t){var r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.onload=r.onerror=function(){r.onload=r.onerror=null,t&&t(),setTimeout(function(){r&&(r.parentNode.removeChild(r),r=null)},2e3)},r.async=!0,D.appendChild(r),r.src=e,r}function i(){return q+=1,Number(Math.round(1e6*(Math.random()+1))+((new Date).getTime()-R)+""+q).toString(36)}function a(e){return _.setAttribute("href",e),_.href}function s(e,t){return t?e+(e.indexOf("?")>-1?"&":"?")+t:e}function u(e,t){return e instanceof window.FormData?e:e&&"string"!=typeof e?"json"==t?JSON.stringify(e):j.stringify(e):e||""}function c(e){return"json"==e?"application/json":"application/x-www-form-urlencoded"}function l(e){if(!e.json&&e.text)try{e.json=JSON.parse(e.text)}catch(t){e.json={}}e.json&&(e.result=e.json);var t=e.getHeader("Date");t&&this.root.setDate(t),delete this._req,this.emit("verify",e),!0!==e.cancel&&this.emit("callback",e)}function h(e){var t=this,r=e.forReq,n=r.param,a=r.jsonpKey||this.jsonpKey,u=n[a];u||(n[a]=u="jsonp_"+i());var c=void 0,h=function(n){c||(c=!0,e.json=n,e.text="",e.err=n?null:"http error",r.outFlag||l.call(t,e))};window[u]=h;var f=s(r.url,n);this.emit("send",r),o(f,function(){h()})}function f(e){function t(t){if(!n.outFlag){e.getHeader=function(e){try{return t.headers.get(e)}catch(e){return""}},e.status=t.status,e.text="",e.err=t.ok?null:"http error ["+e.status+"]";var r=["",null];try{r[0]=t.text()}catch(e){}if(["json","text"].indexOf(n.resType)<0)try{r[1]=t[n.resType]()}catch(e){}Promise.all(r).then(f,f)}delete n.outFlag}var r=this,n=e.forReq,o=String(n.method||"GET").toUpperCase(),i=n.param,a={method:o,headers:n.header},h=u(i,n.dataType);"GET"==o?(n.url=s(n.url,h),a.body=i=null):(a.body=h||null,void 0!==n.header["Content-Type"]||n.isFormData||(n.header["Content-Type"]=c(n.dataType))),void 0!==n.header["X-Requested-With"]||n.isCross||(n.header["X-Requested-With"]="XMLHttpRequest"),n.isCross?(a.mode="cors",n.withCredentials&&(a.credentials="include")):a.credentials="same-origin";var f=function(t){var n=_slicedToArray(t,2),o=n[0],i=n[1];e.text=o,e.result=i,l.call(r,e)};this.emit("send",n),window.fetch(n.url,a).then(t,t)}function p(e){return window.XDomainRequest&&e?new window.XDomainRequest:new window.XMLHttpRequest}function d(e){var t=e.forReq,r=t.xhr;if(r&&!t.outFlag){var n="";try{n=r.getAllResponseHeaders()}catch(e){}e.headers={get:function(e){return new RegExp("(?:"+e+"):[ \t]*([^\r\n]*)\r").test(n)?RegExp.$1:""}},e.text="";try{e.text=r.responseText}catch(e){}e.result=null;try{e.result=r.response}catch(e){}e.status=0;try{e.status=r.status}catch(e){}var o=e.status;e.err=o>=200&&o<300||304===o||1223===o?null:"http error ["+o+"]",l.call(this,e)}delete t.xhr,delete t.outFlag}function y(e){var t=this,r=e.forReq;r.xhr=p(r.isCross);var n=r.isXDR=r.xhr.constructor==window.XDomainRequest,o=String(r.method||"GET").toUpperCase();r.withCredentials&&(r.xhr.withCredentials=!0);var i=u(r.param,r.dataType);if("GET"==o?(r.xhr.open(o,s(r.url,i),!0),i=null):(n&&(r.url=s(r.url,i),i=null),r.xhr.open(o,r.url,!0),void 0!==r.header["Content-Type"]||r.isFormData||(r.header["Content-Type"]=c(r.dataType))),void 0!==r.header["X-Requested-With"]||r.isCross||(r.header["X-Requested-With"]="XMLHttpRequest"),n||C(r.header,function(e,t){r.xhr.setRequestHeader(t,e)}),e.status=0,this.hasEvent("progress"))try{r.xhr.upload.onprogress=function(){t.emit("progress",event)}}catch(e){}r.xhr.onload=d.bind(this,e),this.emit("send",r),["arrayBuffer","blob"].indexOf(r.resType)>=0&&(r.xhr.responseType=r.resType),i&&(i=i.replace(/[\x00-\x08\x11-\x12\x14-\x20]/g,"*")),r.xhr.send(i)}function v(e,t){var r=this;if(!t.outFlag){t.method=String(this.method||"get").toUpperCase(),t.url=this.url,t.cache=this.cache;var o=t.dataType=String(this.dataType||"").toLowerCase();t.resType=this.resType;var s=Object.create(k);s.forReq=t,s.root=this;var u=!1;window.FormData&&e instanceof window.FormData&&(u=!0),t.isFormData=u,u?(C(this.param,function(t,r){e.has(r)&&e.append(r,t)}),t.param=e):("string"==typeof e&&(e="json"==t.dataType?JSON.parse(e):j.parse(e)),t.param=n({},this.param,e||{})),t.header=n({},this.header),this.emit("open",t),t.isFormData=u,t.dataType=o;var c=String(t.method||"get").toUpperCase();return"GET"==c&&(!1!==t.cache||t.param._r_||(t.param._r_=i())),(t.url=t.url.replace(/^(\w+):\/*/,function(e,t){return r.paths[t]||e}),this.baseURL&&!/^(:?http(:?s)?:)?\/\//.test(t.url)&&(t.url=this.baseURL+t.url),t.isCross=!/:\/\/$/.test(a(t.url).split(T)[0]||""),"JSONP"==c)?void h.call(this,s):x&&this.useFetch&&!this.hasEvent("progress")?void f.call(this,s):void y.call(this,s)}}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.baseURL,r=e.paths,n=e.useFetch,o=e.url,i=e.method,a=e.dataType,s=e.resType,u=e.param,c=void 0===u?{}:u,l=e.header,h=void 0===l?{}:l,f=e.jsonpKey,p={};return t&&(p.baseURL=t),r&&(p.paths=r),"boolean"==typeof n&&(p.useFetch=n),o&&(p.url=o),i&&(p.method=i.toUpperCase()),c&&(p.param=c),h&&(p.header=h),a&&(p.dataType=a),s&&(p.resType=s),f&&(p.jsonpKey=f),p}function g(e){var t=this._req;t&&(t.outFlag=!0,t.xhr&&(t.xhr.abort(),t.xhr=null),delete this._req,e&&this.emit("abort",t))}function w(e){return O.prototype[e]=function(t,r,n){var o=new E(this,{url:t,method:e});return r&&o.on("callback",r),o.send(n),o}}var b=Object.prototype.toString,T=window.location.host,x=!!window.fetch,C=function(){function e(e,t){return e.push(t),t}function t(e,t,r){e[r]=t}function r(){return arguments[1]}return function(n,o,i,a){if(a||(a=this),n){var s=i?i.push?e:t:r,u=n.length;if("-[object array]-[object nodelist]-[object htmlcollection]-[object arguments]-".indexOf("-"+b.call(n).toLowerCase()+"-")>-1||"[object htmlcollection]"==String(n).toLowerCase())for(var c=0;c<u;c+=1){var l=o.call(a,n[c],c);if(!1===l)break;s(i,l,c)}else for(var h in n)if(!n.hasOwnProperty||n.hasOwnProperty(h)){var f=o.call(a,n[h],h);if(!1===f)break;s(i,f,h)}}return i||a}}(),j={parse:function(e,t){var r=t&&t.sep||"&",n=t&&t.eq||"=",o=t&&t.unescape||window.decodeURIComponent,i={};return e.replace(/^[\s#?]+/,"").split(r).forEach(function(e){if(e){var t=e.split(n),r=t[0];if(r){var a=o(t[1]||"");void 0===i[r]?i[r]=a:i[r].push?i[r].push(a):i[r]=[i[r],a]}}}),i},stringify:function(e,t){var r=t&&t.sep||"&",n=t&&t.eq||"=",o=t&&t.escape||window.encodeURIComponent,i=[];return C(e,function(e,t){null==e&&(e="");var r=o(t);e&&e.constructor==Array?e.forEach(function(e){i.push(r+n+o(e))}):i.push(r+n+o(e))}),i.join(r)}},D=document.head||document.getElementsByTagName("head")[0]||document.documentElement,R=(new Date).getTime()-1e6,q=1e3,_=document.createElement("a"),k={getDate:function(){return this.root.root.getDate()},getJSON:function(e,t){return void 0===t&&(t=this[this.jsonKey||"json"]),e&&e.split(".").forEach(function(e){if(null==(t=t[e]))return!1}),t},getHeader:function(e){var t="";if(this.headers)try{t=this.headers.get(e)}catch(e){}return t}},S={useFetch:!0,resType:"json",jsonpKey:"callback"},E=function(){function e(t,r){_classCallCheck(this,e),this.root=t,this.events={},n(this,t.conf,m(r))}return _createClass(e,[{key:"setConf",value:function(){return n(this,m(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})),this}},{key:"assign",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return"string"==typeof t[0]?this.assign(_defineProperty({},t[0],t[1])):(t.unshift(this),n.apply(Object,t)),this}},{key:"abort",value:function(){return g.call(this,!0),this}},{key:"timeout",value:function(e,t){var r=this;return setTimeout(function(){var e=r._req;e&&(g.call(r),r.emit("timeout",e))},e),t&&this.on("timeout",t),this}},{key:"send",value:function(e,t){if(this._req){if(!t)return this;this.abort()}var r=this._req={root:this};return setTimeout(v.bind(this,e||{},r),1),this}},{key:"emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return r(this.events[e],this,n),r(this.root.events[e],this,n),this}},{key:"hasEvent",value:function(e){var t=this.events[e];return!!(t&&t.length>0)||((t=this.root.events[e])&&t.length>0||!1)}}]),e}();E.prototype.on=e,E.prototype.off=t;var F=0,O=function(){function e(t){_classCallCheck(this,e),this.dateDiff=F,this.conf=n({},S),this.events={},t&&this.setConf(t)}return _createClass(e,[{key:"setConf",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this.conf,m(e))}},{key:"create",value:function(e){return new E(this,e)}},{key:"fetch",value:function(e){var t=new E(this,e);return new Promise(function(e,r){t.on("callback",function(t){t.err?r(t):e(t)}),t.on("timeout",function(){r({err:"访问超时"})}),t.on("abort",function(){r({err:"访问中止"})}),t.send()})}},{key:"setDate",value:function(e){"string"==typeof e&&(e=new Date(e.replace(/T/," ").replace(/\.\d+$/,""))),e&&e.getTime()&&(this.dateDiff=F=e.getTime()-(new Date).getTime())}},{key:"getDate",value:function(){return new Date(this.dateDiff+(new Date).getTime())}}]),e}();O.prototype.on=e,O.prototype.off=t,w("get"),w("post"),w("put"),w("jsonp");var U=new O;return U.Request=O,U.util={assign:n,forEach:C,qs:j,loadJS:o,getUUID:i,getFullUrl:a},U});